(function(r,i){typeof exports=="object"&&typeof module<"u"?module.exports=i(require("lucide-react"),require("react"),require("react-router-dom")):typeof define=="function"&&define.amd?define(["lucide-react","react","react-router-dom"],i):(r=typeof globalThis<"u"?globalThis:r||self,r.deluge=i(r.LucideReact,r.React,r.ReactRouterDOM))})(this,(function(r,i,I){"use strict";var k={exports:{}},w={};var A;function E(){if(A)return w;A=1;var t=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function l(d,a,o){var p=null;if(o!==void 0&&(p=""+o),a.key!==void 0&&(p=""+a.key),"key"in a){o={};for(var g in a)g!=="key"&&(o[g]=a[g])}else o=a;return a=o.ref,{$$typeof:t,type:d,key:p,ref:a!==void 0?a:null,props:o}}return w.Fragment=n,w.jsx=l,w.jsxs=l,w}var _;function M(){return _||(_=1,k.exports=E()),k.exports}var e=M();let b=null,C=null,$=1;const S=()=>$++,u={login:async(t,n)=>{try{console.log(`Connecting to Deluge at ${t}`),C=t;const l={method:"auth.login",params:[n],id:S()},d=await window.electronAPI.proxyRequest(`${t}/json`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(l)}),a=d.data;if(d.ok&&a&&!a.error&&a.result){if(d.headers){const o=d.headers["set-cookie"]||d.headers["Set-Cookie"];o&&(b=o.split(";")[0])}return!0}return!1}catch(l){return console.error("Deluge login error:",l),!1}},checkConnection:async()=>{if(!b){const t=await window.electronAPI.getCredentials("deluge_url"),n=await window.electronAPI.getCredentials("deluge_password");return t&&n?u.login(t,n):!1}return!0},invoke:async(t,n=[])=>{if(!C){const o=await window.electronAPI.getCredentials("deluge_url");if(o)C=o;else throw new Error("Deluge not configured")}b||await u.checkConnection();const l={method:t,params:n,id:S()},a=(await window.electronAPI.proxyRequest(`${C}/json`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Cookie:b||""},body:JSON.stringify(l)})).data;if(a.error)throw new Error(a.error.message||"Deluge RPC Error");return a.result},getTorrents:async()=>{try{const t=await u.invoke("core.get_torrents_status",[{},["name","progress","state","download_payload_rate","upload_payload_rate","eta","total_size","save_path"]]);return Object.entries(t).map(([n,l])=>({id:n,...l}))}catch(t){return console.error("Error fetching torrents:",t),[]}},addTorrentMagnet:async t=>{try{return await u.invoke("core.add_torrent_magnet",[t,{}]),!0}catch(n){return console.error("Error adding magnet:",n),!1}},pauseTorrent:async t=>u.invoke("core.pause_torrent",[[t]]),resumeTorrent:async t=>u.invoke("core.resume_torrent",[[t]]),removeTorrent:async(t,n=!0)=>u.invoke("core.remove_torrent",[t,n])};function D(t,n=2){if(!+t)return"0 B";const l=1024,d=n<0?0:n,a=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(t)/Math.log(l));return`${parseFloat((t/Math.pow(l,o)).toFixed(d))} ${a[o]}`}function P(t){return`${D(t)}/s`}function B(t){if(t===0)return"-";const n=Math.floor(t/3600),l=Math.floor(t%3600/60);return n>0?`${n}h ${l}m`:`${l}m`}function z(){const t=I.useNavigate(),[n,l]=i.useState([]),[d,a]=i.useState(null),[o,p]=i.useState(""),[g,j]=i.useState(!1),[h,N]=i.useState([]),[v,y]=i.useState(!1),c=i.useRef(null);i.useEffect(()=>{(async()=>await window.electronAPI.getCredentials("deluge_configured")?(a(!0),x()):(a(!1),setTimeout(()=>{t("/settings",{state:{section:"deluge"}})},2e3)))()},[t]),i.useEffect(()=>{if(!d)return;const s=setInterval(x,2e3);return()=>clearInterval(s)},[d]);const x=async()=>{const s=await u.getTorrents();l(s)},f=async(s,m)=>{s==="pause"&&await u.pauseTorrent(m),s==="resume"&&await u.resumeTorrent(m),s==="remove"&&confirm("Voulez-vous vraiment supprimer ce torrent ?")&&await u.removeTorrent(m),x()},T=async()=>{if(confirm("Voulez-vous supprimer tous les torrents terminés (100%) ?")){const s=n.filter(m=>m.progress===100);for(const m of s)await u.removeTorrent(m.id);x()}},q=s=>{s.target.files&&N(m=>[...m,...Array.from(s.target.files)])},L=s=>{s.preventDefault(),y(!0)},U=s=>{s.preventDefault(),y(!1)},F=s=>{s.preventDefault(),y(!1),s.dataTransfer.files&&N(m=>[...m,...Array.from(s.dataTransfer.files)])},J=async()=>{o&&(await u.addTorrentMagnet(o),p(""),j(!1),x()),h.length>0&&(console.log("Files to upload:",h),N([]),j(!1))};return d===!1?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[60vh] text-center p-8",children:[e.jsx(r.AlertCircle,{className:"h-16 w-16 text-yellow-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Deluge non configuré"}),e.jsx("p",{className:"text-muted-foreground",children:"Redirection vers les paramètres..."})]}):e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(r.Download,{className:"h-8 w-8"}),"Deluge"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:T,className:"flex items-center gap-2 px-4 py-2 bg-secondary text-secondary-foreground rounded-lg hover:bg-secondary/80 transition-colors",title:"Supprimer les torrents terminés",children:[e.jsx(r.Trash2,{className:"h-4 w-4"}),"Nettoyer"]}),e.jsxs("button",{onClick:()=>j(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors",children:[e.jsx(r.Plus,{className:"h-4 w-4"}),"Ajouter"]})]})]}),e.jsx("div",{className:"bg-card border rounded-xl shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-muted/50 border-b text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:[e.jsx("th",{className:"px-6 py-3",children:"Nom"}),e.jsx("th",{className:"px-6 py-3",children:"Taille"}),e.jsx("th",{className:"px-6 py-3",children:"Progression"}),e.jsx("th",{className:"px-6 py-3",children:"Vitesse DL/UL"}),e.jsx("th",{className:"px-6 py-3",children:"ETA"}),e.jsx("th",{className:"px-6 py-3",children:"État"}),e.jsx("th",{className:"px-6 py-3 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-border",children:[n.map(s=>e.jsxs("tr",{className:"hover:bg-muted/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(r.File,{className:"h-8 w-8 text-primary/50"}),e.jsx("div",{className:"max-w-[200px] truncate font-medium",title:s.name,children:s.name})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-muted-foreground",children:D(s.total_size)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"w-full max-w-[100px]",children:[e.jsx("div",{className:"flex justify-between text-xs mb-1",children:e.jsxs("span",{children:[s.progress.toFixed(1),"%"]})}),e.jsx("div",{className:"h-2 bg-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${s.state==="Seeding"?"bg-green-500":"bg-primary"}`,style:{width:`${s.progress}%`}})})]})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsxs("span",{className:"text-green-500 flex items-center gap-1",children:[e.jsx(r.Download,{className:"h-3 w-3"})," ",P(s.download_payload_rate)]}),e.jsxs("span",{className:"text-blue-500 flex items-center gap-1",children:[e.jsx(r.Upload,{className:"h-3 w-3"})," ",P(s.upload_payload_rate)]})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-muted-foreground",children:B(s.eta)}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                      ${s.state==="Downloading"?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400":""}
                      ${s.state==="Seeding"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":""}
                      ${s.state==="Paused"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400":""}
                    `,children:s.state})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.state==="Paused"?e.jsx("button",{onClick:()=>f("resume",s.id),className:"p-2 hover:bg-background rounded-full transition-colors text-green-500",title:"Reprendre",children:e.jsx(r.Play,{className:"h-4 w-4"})}):e.jsx("button",{onClick:()=>f("pause",s.id),className:"p-2 hover:bg-background rounded-full transition-colors text-yellow-500",title:"Pause",children:e.jsx(r.Pause,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>f("remove",s.id),className:"p-2 hover:bg-background rounded-full transition-colors text-destructive",title:"Supprimer",children:e.jsx(r.Trash2,{className:"h-4 w-4"})})]})})]},s.id)),n.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"px-6 py-12 text-center text-muted-foreground",children:[e.jsx(r.HardDrive,{className:"h-12 w-12 mx-auto mb-3 opacity-20"}),"Aucun torrent actif"]})})]})]})})}),g&&e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-card border rounded-xl shadow-lg w-full max-w-lg p-6 space-y-4 animate-in fade-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Ajouter un torrent"}),e.jsx("button",{onClick:()=>j(!1),className:"p-2 hover:bg-muted rounded-full",children:e.jsx(r.X,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Lien Magnet"}),e.jsx("input",{type:"text",value:o,onChange:s=>p(s.target.value),placeholder:"magnet:?xt=urn:btih:...",className:"w-full px-3 py-2 bg-background border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-card px-2 text-muted-foreground",children:"Ou déposer un fichier"})})]}),e.jsxs("div",{onDragOver:L,onDragLeave:U,onDrop:F,onClick:()=>c.current?.click(),className:`
                  border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-colors
                  ${v?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-primary/50"}
                `,children:[e.jsx("input",{type:"file",ref:c,onChange:q,className:"hidden",accept:".torrent",multiple:!0}),e.jsx(r.Upload,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Cliquez ou glissez vos fichiers .torrent ici"}),h.length>0&&e.jsx("div",{className:"mt-4 space-y-1",children:h.map((s,m)=>e.jsxs("div",{className:"text-xs bg-muted py-1 px-2 rounded flex items-center justify-between",children:[e.jsx("span",{className:"truncate max-w-[200px]",children:s.name}),e.jsx("span",{className:"text-muted-foreground",children:D(s.size)})]},m))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{onClick:()=>j(!1),className:"px-4 py-2 hover:bg-muted rounded-lg transition-colors",children:"Annuler"}),e.jsx("button",{onClick:J,disabled:!o&&h.length===0,className:"px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50",children:"Ajouter"})]})]})]})})]})}function O(){const[t,n]=i.useState(!1),[l,d]=i.useState("http://localhost:8112"),[a,o]=i.useState(""),[p,g]=i.useState("idle"),[j,h]=i.useState(""),[N,v]=i.useState(!1);i.useEffect(()=>{(async()=>{const x=await window.electronAPI.getCredentials("deluge_url"),f=await window.electronAPI.getCredentials("deluge_password"),T=await window.electronAPI.getCredentials("deluge_configured");x&&d(x),f&&o(f),T==="true"&&v(!0)})()},[]);const y=async()=>{g("loading"),h("");try{let c=l.trim();!c.startsWith("http://")&&!c.startsWith("https://")&&(c=`http://${c}`);let x=await u.login(c,a);if(!x&&l.trim()===c.replace("http://","")){const f=`https://${l.trim()}`;x=await u.login(f,a),x&&(c=f)}x?(d(c),await window.electronAPI.saveCredentials("deluge_url",c),await window.electronAPI.saveCredentials("deluge_password",a),await window.electronAPI.saveCredentials("deluge_configured","true"),g("success"),h("Connexion réussie et configuration sauvegardée"),v(!0)):(g("error"),h("Échec de la connexion. Vérifiez l'URL et le mot de passe."),v(!1))}catch{g("error"),h("Erreur lors du test de connexion"),v(!1)}};return t?e.jsxs("div",{className:"rounded-lg border bg-card shadow-sm overflow-hidden transition-all",children:[e.jsxs("div",{onClick:()=>n(!1),className:"flex items-center justify-between p-4 border-b bg-muted/30 cursor-pointer hover:bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-full",children:e.jsx(r.Download,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Deluge"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connexion au client torrent"})]})]}),e.jsx(r.ChevronDown,{className:"h-5 w-5 text-muted-foreground"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"URL de Deluge"}),e.jsx("input",{type:"text",value:l,onChange:c=>d(c.target.value),className:"w-full rounded-md border bg-background px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"http://localhost:8112"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Mot de passe"}),e.jsx("input",{type:"password",value:a,onChange:c=>o(c.target.value),className:"w-full rounded-md border bg-background px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Votre mot de passe Deluge"})]}),j&&e.jsxs("div",{className:`flex items-center gap-2 rounded-md p-3 text-sm ${p==="success"?"bg-green-500/10 text-green-500":"bg-destructive/10 text-destructive"}`,children:[p==="success"?e.jsx(r.Check,{className:"h-4 w-4"}):e.jsx(r.AlertCircle,{className:"h-4 w-4"}),j]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsxs("button",{onClick:y,disabled:p==="loading",className:"flex items-center gap-2 rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 disabled:opacity-50",children:[p==="loading"?e.jsx(r.Loader2,{className:"h-4 w-4 animate-spin"}):e.jsx(r.Save,{className:"h-4 w-4"}),"Tester & Sauvegarder"]})})]})]}):e.jsxs("div",{onClick:()=>n(!0),className:"flex items-center justify-between rounded-lg border bg-card p-4 shadow-sm hover:bg-accent/50 cursor-pointer transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-full",children:e.jsx(r.Download,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Deluge"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configuration de la connexion au client Deluge"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[N?e.jsxs("div",{className:"flex items-center gap-2 text-green-500 text-sm font-medium",children:[e.jsx(r.Check,{className:"h-4 w-4"})," Connecté"]}):e.jsx("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:"Non connecté"}),e.jsx(r.ChevronRight,{className:"h-5 w-5 text-muted-foreground"})]})]})}return{manifest:{id:"deluge",name:"Deluge",version:"1.0.0",description:"Gestionnaire de téléchargements BitTorrent",author:"MG Tools Core",minAppVersion:"0.1.0"},routes:[{path:"/deluge",element:e.jsx(z,{})}],sidebarItems:[{id:"deluge",label:"Deluge",icon:r.Download,path:"/deluge",order:1}],settings:O,services:[{id:"download",implementation:u}]}}));
