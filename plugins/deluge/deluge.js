(function(n,c){typeof exports=="object"&&typeof module<"u"?module.exports=c(require("lucide-react"),require("react"),require("react-router-dom")):typeof define=="function"&&define.amd?define(["lucide-react","react","react-router-dom"],c):(n=typeof globalThis<"u"?globalThis:n||self,n.deluge=c(n.LucideReact,n.React,n.ReactRouterDOM))})(this,(function(n,c,I){"use strict";var T={exports:{}},b={};var P;function F(){if(P)return b;P=1;var s=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function o(a,d,l){var x=null;if(l!==void 0&&(x=""+l),d.key!==void 0&&(x=""+d.key),"key"in d){l={};for(var f in d)f!=="key"&&(l[f]=d[f])}else l=d;return d=l.ref,{$$typeof:s,type:a,key:x,ref:d!==void 0?d:null,props:l}}return b.Fragment=r,b.jsx=o,b.jsxs=o,b}var E;function $(){return E||(E=1,T.exports=F()),T.exports}var e=$();let _=null,w=null,z=1;const M=()=>z++,u={login:async(s,r)=>{try{console.log(`Connecting to Deluge at ${s}`),w=s;const o={method:"auth.login",params:[r],id:M()},a=await window.electronAPI.proxyRequest(`${s}/json`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(o)}),d=a.data;if(a.ok&&d&&!d.error&&d.result){if(a.headers){const l=a.headers["set-cookie"]||a.headers["Set-Cookie"];l&&(_=l.split(";")[0])}return!0}return!1}catch(o){return console.error("Deluge login error:",o),!1}},checkConnection:async()=>{if(!_){const s=await window.electronAPI.getCredentials("deluge_url"),r=await window.electronAPI.getCredentials("deluge_password");return s&&r?u.login(s,r):!1}return!0},invoke:async(s,r=[])=>{if(!w){const x=await window.electronAPI.getCredentials("deluge_url");if(x)w=x;else throw new Error("Deluge not configured")}_||await u.checkConnection();const o={method:s,params:r,id:M()},a={"Content-Type":"application/json",Accept:"application/json"};_&&(a.Cookie=_);const l=(await window.electronAPI.proxyRequest(`${w}/json`,{method:"POST",headers:a,body:JSON.stringify(o)})).data;if(l&&l.error)throw new Error(l.error.message||"RPC Error");return l?.result},getStats:async()=>{try{const s=await u.getTorrents();let r=0,o=0,a=0,d=0;return s.forEach(l=>{r+=l.download_payload_rate,o+=l.upload_payload_rate,l.state==="Paused"?d++:a++}),{downloadSpeed:Math.floor(r/1024),uploadSpeed:Math.floor(o/1024),activeTorrents:a,pausedTorrents:d}}catch(s){return console.error(s),{downloadSpeed:0,uploadSpeed:0,activeTorrents:0,pausedTorrents:0}}},getTorrents:async()=>{try{const s=["name","total_size","state","progress","download_payload_rate","upload_payload_rate","eta","save_path"],r=await u.invoke("web.update_ui",[s,{}]);return r&&r.torrents?Object.entries(r.torrents).map(([o,a])=>({id:o,name:a.name,total_size:a.total_size,state:a.state,progress:a.progress,download_payload_rate:a.download_payload_rate,upload_payload_rate:a.upload_payload_rate,eta:a.eta,save_path:a.save_path})):[]}catch(s){return console.error("Error fetching torrents:",s),[]}},addMagnet:async s=>{try{if(!w)throw new Error("Not connected");return await u.invoke("core.add_torrent_magnet",[s,{}]),!0}catch(r){return console.error("Failed to add magnet",r),!1}},addTorrentFile:async(s,r)=>{try{if(!w)throw new Error("Not connected");return await u.invoke("core.add_torrent_file",[s,r,{}]),!0}catch(o){return console.error("Failed to add torrent file",o),!1}},removeTorrent:async(s,r=!1)=>{try{return await u.invoke("core.remove_torrent",[s,r]),!0}catch(o){return console.error(o),!1}},pauseTorrent:async s=>{try{return await u.invoke("core.pause_torrent",[[s]]),!0}catch{return!1}},resumeTorrent:async s=>{try{return await u.invoke("core.resume_torrent",[[s]]),!0}catch{return!1}},checkHealth:async()=>{try{return await u.checkConnection()}catch{return!1}}};function D(s,r=2){if(!+s)return"0 B";const o=1024,a=r<0?0:r,d=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],l=Math.floor(Math.log(s)/Math.log(o));return`${parseFloat((s/Math.pow(o,l)).toFixed(a))} ${d[l]}`}function k(s){return`${D(s)}/s`}function B(s){if(s===0)return"-";const r=Math.floor(s/3600),o=Math.floor(s%3600/60);return r>0?`${r}h ${o}m`:`${o}m`}function U(){const s=I.useNavigate(),[r,o]=c.useState([]),[a,d]=c.useState(null),[l,x]=c.useState(""),[f,N]=c.useState(!1),[h,v]=c.useState([]),[y,C]=c.useState(!1),m=c.useRef(null);c.useEffect(()=>{(async()=>await window.electronAPI.getCredentials("deluge_configured")?(d(!0),p()):(d(!1),setTimeout(()=>{s("/settings",{state:{section:"deluge"}})},2e3)))()},[s]),c.useEffect(()=>{if(!a)return;const t=setInterval(p,2e3);return()=>clearInterval(t)},[a]);const p=async()=>{const t=await u.getTorrents();o(t)},j=async(t,i)=>{t==="pause"&&await u.pauseTorrent(i),t==="resume"&&await u.resumeTorrent(i),t==="remove"&&confirm("Voulez-vous vraiment supprimer ce torrent ?")&&await u.removeTorrent(i),p()},S=async()=>{if(confirm("Voulez-vous supprimer tous les torrents terminés (100%) ?")){const t=r.filter(i=>i.progress===100);for(const i of t)await u.removeTorrent(i.id);p()}},O=t=>{t.target.files&&v(i=>[...i,...Array.from(t.target.files)])},q=t=>{t.preventDefault(),C(!0)},R=t=>{t.preventDefault(),C(!1)},V=t=>{if(t.preventDefault(),C(!1),t.dataTransfer.files){const i=Array.from(t.dataTransfer.files).filter(g=>g.name.endsWith(".torrent"));v(g=>[...g,...i])}},J=t=>{v(i=>i.filter((g,A)=>A!==t))},G=async()=>{let t=!1;if(l&&(await u.addMagnet(l),x(""),t=!0),h.length>0){for(const i of h)try{const g=new FileReader;g.onload=async()=>{const A=g.result.split(",")[1];await u.addTorrentFile(i.name,A)},g.readAsDataURL(i)}catch(g){console.error("Error reading file",i.name,g)}v([]),t=!0}t&&(N(!1),setTimeout(p,500))};return a===!1?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(n.AlertCircle,{className:"mx-auto h-12 w-12 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Module non configuré"}),e.jsx("p",{className:"text-muted-foreground",children:"Redirection vers les paramètres..."})]})]})}):a===null?e.jsx("div",{children:"Chargement..."}):e.jsxs("div",{className:"space-y-6 h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(n.Download,{className:"h-6 w-6"}),"Deluge"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:S,className:"flex items-center gap-2 rounded-md bg-destructive px-4 py-2 text-sm font-medium text-destructive-foreground hover:bg-destructive/90",title:"Supprimer les torrents terminés",children:[e.jsx(n.Trash2,{className:"h-4 w-4"})," Tout nettoyer"]}),e.jsxs("button",{onClick:()=>N(!0),className:"flex items-center gap-2 rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90",children:[e.jsx(n.Plus,{className:"h-4 w-4"})," Ajouter"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg border bg-card text-card-foreground shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(n.Download,{className:"h-4 w-4"})," Download"]}),e.jsx("div",{className:"text-2xl font-bold",children:k(r.reduce((t,i)=>t+i.download_payload_rate,0))})]}),e.jsxs("div",{className:"p-4 rounded-lg border bg-card text-card-foreground shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(n.Upload,{className:"h-4 w-4"})," Upload"]}),e.jsx("div",{className:"text-2xl font-bold",children:k(r.reduce((t,i)=>t+i.upload_payload_rate,0))})]}),e.jsxs("div",{className:"p-4 rounded-lg border bg-card text-card-foreground shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(n.Play,{className:"h-4 w-4"})," Actifs"]}),e.jsx("div",{className:"text-2xl font-bold",children:r.filter(t=>t.state==="Downloading"||t.state==="Seeding").length})]}),e.jsxs("div",{className:"p-4 rounded-lg border bg-card text-card-foreground shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[e.jsx(n.HardDrive,{className:"h-4 w-4"})," Total Size"]}),e.jsx("div",{className:"text-2xl font-bold",children:D(r.reduce((t,i)=>t+i.total_size,0))})]})]}),e.jsx("div",{className:"flex-1 rounded-lg border bg-card text-card-foreground shadow-sm overflow-hidden flex flex-col",children:e.jsx("div",{className:"overflow-x-auto flex-1",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/50 text-xs uppercase font-medium text-muted-foreground sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Nom"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Taille"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Progression"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Vitesse DL"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Vitesse UL"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"ETA"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y",children:[r.map(t=>e.jsxs("tr",{className:"hover:bg-muted/50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3 font-medium",children:[e.jsx("div",{className:"truncate max-w-[200px] md:max-w-[300px]",title:t.name,children:t.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t.state})]}),e.jsx("td",{className:"px-4 py-3 text-muted-foreground",children:D(t.total_size)}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2 w-32",children:[e.jsx("div",{className:"h-2 w-full bg-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-500",style:{width:`${t.progress}%`}})}),e.jsxs("span",{className:"text-xs w-10 text-right",children:[t.progress.toFixed(1),"%"]})]})}),e.jsx("td",{className:"px-4 py-3 text-green-600 dark:text-green-400 font-mono",children:t.download_payload_rate>0?k(t.download_payload_rate):"-"}),e.jsx("td",{className:"px-4 py-3 text-blue-600 dark:text-blue-400 font-mono",children:t.upload_payload_rate>0?k(t.upload_payload_rate):"-"}),e.jsx("td",{className:"px-4 py-3 text-muted-foreground",children:B(t.eta)}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[t.state==="Paused"?e.jsx("button",{onClick:()=>j("resume",t.id),className:"p-1 hover:bg-muted rounded text-green-500",title:"Reprendre",children:e.jsx(n.Play,{className:"h-4 w-4"})}):e.jsx("button",{onClick:()=>j("pause",t.id),className:"p-1 hover:bg-muted rounded text-yellow-500",title:"Pause",children:e.jsx(n.Pause,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>j("remove",t.id),className:"p-1 hover:bg-muted rounded text-destructive",title:"Supprimer",children:e.jsx(n.Trash2,{className:"h-4 w-4"})})]})})]},t.id)),r.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-8 text-center text-muted-foreground",children:"Aucun torrent actif"})})]})]})})}),f&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"w-full max-w-lg rounded-lg border bg-background p-6 shadow-lg",children:[e.jsx("h2",{className:"mb-4 text-xl font-bold",children:"Ajouter des torrents"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Lien Magnet"}),e.jsx("input",{type:"text",value:l,onChange:t=>x(t.target.value),className:"mt-1 w-full rounded-md border bg-background px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"magnet:?xt=urn:btih:..."})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"OU"})})]}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors ${y?"border-primary bg-primary/10":"border-muted-foreground/25 hover:border-primary/50"}`,onDragOver:q,onDragLeave:R,onDrop:V,onClick:()=>m.current?.click(),children:[e.jsx("input",{type:"file",ref:m,className:"hidden",multiple:!0,accept:".torrent",onChange:O}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(n.File,{className:"h-8 w-8 text-muted-foreground"}),e.jsx("p",{className:"text-sm font-medium",children:"Glissez vos fichiers .torrent ici"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ou cliquez pour parcourir"})]})]}),h.length>0&&e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:h.map((t,i)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded bg-muted/50 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 truncate",children:[e.jsx(n.File,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"truncate",children:t.name})]}),e.jsx("button",{onClick:()=>J(i),className:"text-muted-foreground hover:text-destructive",children:e.jsx(n.X,{className:"h-4 w-4"})})]},i))})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>{N(!1),x(""),v([])},className:"rounded-md border px-4 py-2 text-sm font-medium hover:bg-muted",children:"Annuler"}),e.jsx("button",{onClick:G,disabled:!l&&h.length===0,className:"rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 disabled:opacity-50",children:"Ajouter"})]})]})})]})}function L(){const[s,r]=c.useState(!1),[o,a]=c.useState("http://localhost:8112"),[d,l]=c.useState(""),[x,f]=c.useState("idle"),[N,h]=c.useState(""),[v,y]=c.useState(!1);c.useEffect(()=>{(async()=>{const p=await window.electronAPI.getCredentials("deluge_url"),j=await window.electronAPI.getCredentials("deluge_password"),S=await window.electronAPI.getCredentials("deluge_configured");p&&a(p),j&&l(j),S==="true"&&y(!0)})()},[]);const C=async()=>{f("loading"),h("");try{let m=o.trim();!m.startsWith("http://")&&!m.startsWith("https://")&&(m=`http://${m}`);let p=await u.login(m,d);if(!p&&o.trim()===m.replace("http://","")){const j=`https://${o.trim()}`;p=await u.login(j,d),p&&(m=j)}p?(a(m),await window.electronAPI.saveCredentials("deluge_url",m),await window.electronAPI.saveCredentials("deluge_password",d),await window.electronAPI.saveCredentials("deluge_configured","true"),f("success"),h("Connexion réussie et configuration sauvegardée"),y(!0)):(f("error"),h("Échec de la connexion. Vérifiez l'URL et le mot de passe."),y(!1))}catch{f("error"),h("Erreur lors du test de connexion"),y(!1)}};return s?e.jsxs("div",{className:"rounded-lg border bg-card shadow-sm overflow-hidden transition-all",children:[e.jsxs("div",{onClick:()=>r(!1),className:"flex items-center justify-between p-4 border-b bg-muted/30 cursor-pointer hover:bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-full",children:e.jsx(n.Download,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Deluge"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connexion au client torrent"})]})]}),e.jsx(n.ChevronDown,{className:"h-5 w-5 text-muted-foreground"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"URL de Deluge"}),e.jsx("input",{type:"text",value:o,onChange:m=>a(m.target.value),className:"w-full rounded-md border bg-background px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"http://localhost:8112"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Mot de passe"}),e.jsx("input",{type:"password",value:d,onChange:m=>l(m.target.value),className:"w-full rounded-md border bg-background px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Votre mot de passe Deluge"})]}),N&&e.jsxs("div",{className:`flex items-center gap-2 rounded-md p-3 text-sm ${x==="success"?"bg-green-500/10 text-green-500":"bg-destructive/10 text-destructive"}`,children:[x==="success"?e.jsx(n.Check,{className:"h-4 w-4"}):e.jsx(n.AlertCircle,{className:"h-4 w-4"}),N]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsxs("button",{onClick:C,disabled:x==="loading",className:"flex items-center gap-2 rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 disabled:opacity-50",children:[x==="loading"?e.jsx(n.Loader2,{className:"h-4 w-4 animate-spin"}):e.jsx(n.Save,{className:"h-4 w-4"}),"Tester & Sauvegarder"]})})]})]}):e.jsxs("div",{onClick:()=>r(!0),className:"flex items-center justify-between rounded-lg border bg-card p-4 shadow-sm hover:bg-accent/50 cursor-pointer transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-full",children:e.jsx(n.Download,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Deluge"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configuration de la connexion au client Deluge"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[v?e.jsxs("div",{className:"flex items-center gap-2 text-green-500 text-sm font-medium",children:[e.jsx(n.Check,{className:"h-4 w-4"})," Connecté"]}):e.jsx("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:"Non connecté"}),e.jsx(n.ChevronRight,{className:"h-5 w-5 text-muted-foreground"})]})]})}return{manifest:{id:"deluge",name:"Deluge",version:"1.0.1",description:"Gestionnaire de téléchargements BitTorrent",author:"MG Tools Core",minAppVersion:"0.1.0"},routes:[{path:"/deluge",element:e.jsx(U,{})}],sidebarItems:[{id:"deluge",label:"Deluge",icon:n.Download,path:"/deluge",order:1}],settings:L,services:[{id:"download",implementation:u}]}}));
